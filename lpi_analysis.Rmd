---
title: "LPI_neutral_theory"
author: "James G. Hagan"
date: "05/08/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

I had some time and energy so I looked into the LPI calculation in some more detail and also did some preliminary analysis on the LPI data to see how the input data has changed through time. Perhaps they correct for this in some way but the changes have been quite striking.


## How have the starting populations changed through time?

This is plot is just the mean (and SE) for all population values at each year in the dataset. There has been a decline through time which might indeed make the random fluctuations more meaningul. 

However, the complicated issue with this is these are just the actual population values. My reading of the code from rlpi package and the McCrae et al. (2017) paper is that they do a fair bit of extrapolation for time-series with incomplete data. For example, if the time-series has more than six population size values, say: 1971, 1974, 1975, 1976, 1980, 1982 and 1985. Population size for all years between 1971 and 1985 are interpolated using a generalised additive model. Therefore, for each pair of years (i.e. 1971-1972, 1972-1973 etc.) a d-value is calculated. When there are fewer than six population size values in a time-series they use a slighty different interpolation method but not for all years between the initial and final years in the time-series. Long story short is that plotted here are just the actual data but the LPI is calculated using interpolated population data as well which means that this is not completely reflective.

```{r pressure, echo=FALSE}
ggplot(data = pop_all,
       mapping = aes(x = year, y = population_size_m)) +
  geom_errorbar(mapping = aes(ymin = population_size_m-population_size_se,
                              ymax = population_size_m+population_size_se),
                width = 0.1) +
  geom_point(alpha = 1, shape = 16, size = 2) +
  geom_smooth(size = 0.1, colour = "black") +
  scale_colour_viridis_d() +
  xlab("year") +
  ylab("mean +- se population size") +
  theme_classic()
```


## How has the population composition changed through time?

For this, I looked at the representation of different Classes (i.e. Aves, Amphibia) etc. through time. I'm more confident in this analysis because I included a species in the analysis for all years between the start and end years in the series. This partially circumvents the problem that plagues the analysis of changes in the population size through time.

There has been a clear shift in species composition through time. I showed this by using the Jaccard dissimilarity in Class-level composition through time using a PCoA:

```{r pressure, echo=FALSE}
ggplot(data = mds.1_raw,
       mapping = aes(x = year, y = mds_1)) +
  geom_jitter(size = 2.5, alpha = 0.9) +
  geom_smooth(size = 0.1, alpha = 0.5, colour = "black") +
  scale_colour_viridis_c() +
  ylab("MDS1 (43 %)") +
  theme_classic()
```

I then also looked at how the proportion of time-series in different classes has changed through time. Main patterns are a decline in proportion of mammal time-series and an increase in the proportion of Actinopterygii (ray-finned fishes). 

```{r pressure, echo=FALSE}
ggplot(data = prop_class,
       mapping = aes(x = year, y = class_proportion, colour = Class)) +
  geom_point() +
  geom_smooth(method = "lm", size = 0.1, se = TRUE, alpha = 0.1) +
  scale_colour_viridis_d() +
  ylab("proportion time-series") +
  theme_classic()
```


## Conclusions

Main message from this is that if we want to see how the starting population sizes have changed through time and whether this affects the LPI, we will have to figure out how they do their interpolations. The rlpi code is not easy to follow but it would be doable to extract their code for how they do the interpolations with some serious effort.


